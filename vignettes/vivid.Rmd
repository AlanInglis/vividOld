---
title: "Variable Importance and Variable Interaction Displays (vivid)"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{vivid}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.width = 7,
  fig.height = 7
)
```

```{r setup, message=FALSE, echo = FALSE}
library(vivid)
```

## Introduction

This package was designed to help a user to easily distinguish which
variables in a model are important and which variables interact with
each other. It does this by giving the user different plotting options.
These include a heatmap style plot that displays 2-way interactions and
individual variable importance. Also, a network style plot where the
size of a node represents variable importance (the bigger the node, the
more important the variable) and the edge weight represents the 2-way
interaction strength. Also included is an option to display partial
dependence plots that utilize an Eularian tour to help the user to
easily identify which variables interact the most. The interaction is
calculated using *Friedman’s H-Statistic*\[1\].

## Data used in this vignette:

The data used in the following examples is the *air quality* data which
is the daily air quality measurements in New York, May to September
1973\[2\]. The data contains 6 variables which are described as follows:

  - Ozone: Mean ozone in parts per billion from 1300 to 1500 hours at
    Roosevelt Island.

  - Solar.R: Solar radiation in Langleys in the frequency band 4000–7700
    Angstroms from 0800 to 1200 hours at Central Park.

  - Wind: Average wind speed in miles per hour at 0700 and 1000 hours at
    LaGuardia Airport.

  - Temp: Maximum daily temperature in degrees Fahrenheit at La Guardia
    Airport.

  - Month: The month the data was recorded (takes a value between 1-12).

  - Day: The day the the data was recorded (takes a value between 1-7).

In all the following examples, *Ozone* is used as the response variable.

## Commands:

# `intHeatmap()`

-----

*Create a Heatmap style plot displaying Variable Importance and Variable
Interaction*

-----

**Description**

Plots a heatmap of the interaction strength with variable importance on
the off-diagonal

**Usage**

intHeatmap(task, model, method, plotly, intLow, intHigh, impLow, impHigh, top)


**Example**

Load in the data:
```{r, messages = FALSE}
aq <- data.frame(airquality)
aq <- na.omit(aq)
```

Run an `mlr` random forest model:

```{r}
library(mlr)
aqRgrTask  <- makeRegrTask(data = aq, target = "Ozone")
aqRegrLrn <- makeLearner("regr.randomForest")
aqMod <- train(aqRegrLrn, aqRgrTask)
```

To call the plot we use the `intHeatmap()` command as follows:

```{r}
#intHeatmap(aqRgrTask, aqMod, method = "randomForest_importance", plotly = F, 
#           intLow = "floralwhite", intHigh = "dodgerblue4",
#           impLow = "white", impHigh = "firebrick1", 
#           top = 0)
```
<center>
Fig 1.0: *Heatmap style plot displaying 2-way interaction strength in blue and individual variable importance on the diagonal in red.*
</center>

From the above plot, the user can easily see that *Temp* is the most important variable when predicting *Ozone*. Also, there is a clear and strong interaction between *Month* and *Day*. 

# `importanceNet()`

-----

*Create a Network style plot displaying Variable Importance and Variable 
Interaction*

-----

**Description**

Plots a network style graph, where node size represents variable importance and edge width and colour represents interaction strength. The edge colour is displayed as a gradient from black to red. Black represents a weak interaction, whereas red displays stronger interactions.

**Usage**

importanceNet(task, model, method, thresholdValue, cluster)

**Example**

Load in the data:
```{r, messages = FALSE}
aq <- data.frame(airquality)
aq <- na.omit(aq)
```

Run an `mlr` random forest model:
```{r}
library(mlr)
aqRgrTask  <- makeRegrTask(data = aq, target = "Ozone")
aqRegrLrn <- makeLearner("regr.randomForest")
aqMod <- train(aqRegrLrn, aqRgrTask)
```

To call the plot we use the `importanceNet()` command as follows:

```{r, fig.width = 8, fig.height = 7}
set.seed(1701)
importanceNet(task = aqRgrTask, model = aqMod, method = "randomForest_importance", thresholdValue = 0, 
              label = T, 
              minInt = 0, maxInt = 1, 
              minImp = 0, maxImp = 100,
              labelNudge = 0.05,
              cluster = F)
```
<center>
Fig 2.0: *Network style plot displaying 2-way interaction strength between each of the variables and individual variable importance*
</center>

The edge width, in the above plot, indicates the interaction strength, with the actual value displayed in the centre of of the edges. The colour of the edges also visually represents the interaction strength through use a of colour gradient, with low values being in black and high values being in red. 

The node size represents individual variable importance with respect to predicting the response. 

As can be seen in the above plot, *Month* and *Day* have the largest interaction and *Temp* is the most important variable for predicting *Ozone*. 

The user can control which interaction values to display by using the `thresholdValue` argument. In the following example, `thresholdValue = 0.09` means that only the the edges with weights (i.e., the interacions) above 0.09 are displayed:

```{r, fig.width = 8, fig.height = 7}
set.seed(1701)
importanceNet(task = aqRgrTask, model = aqMod, method = "randomForest_importance", thresholdValue = 0.09, cluster = F)
```
<center>
Fig 2.1: *Network style plot displaying thresholded 2-way interaction strengths between each of the variables and individual variable importance. In this plot only the interactions greater than 0.09 are shown.*
</center>



# `PDPpairs()`

-----

*Creates a plot of the partial dependence of each of the variables in pairs plot style matrix*

-----

*Description*

Plots a pdp (partial dependence plot) pairs style matrix. The partial dependence plot shows the marginal effect one or two features have on the predicted outcome of a machine learning model^[Friedman, Jerome H. “Greedy function approximation: A gradient boosting machine.” Annals of statistics (2001): 1189-1232.]. A partial dependence plot is used to show whether the relationship between the response variable and a feature is linear or more complex.

**Usage**

pdpPairs(task, model)

**Example**

Load in the data:
```{r, messages = FALSE}
aq <- data.frame(airquality)
aq <- na.omit(aq)
```

Run an `mlr` random forest model:
```{r}
library(mlr)
library(randomForest)
aqRgrTask  <- makeRegrTask(data = aq, target = "Ozone")
aqRegrLrn <- makeLearner("regr.randomForest")
aqMod <- train(aqRegrLrn, aqRgrTask)
```

To call the pdp pairs plot we use:
```{r, fig.width = 8, fig.height = 7}
pdpPairs(task = aqRgrTask, model =  aqMod)
```
<center>
Fig 3.0: *A pairs style matrix plot displaying the partial dependence between each of the variables*
</center>


In addition to displaying both the variable importance and interactions together, the following functions display only the variable importance _or_ the interaction strength. 

# `allInt()`

-----

*Creates a plot, displaying the interaction strength for all the 2-way interactions in a model*

-----

*Description*
Plots a "lollipop" style plot displating the 2-way interactions on the y-axis and the interaction strength on the x-axis. This function also allows the user to switch between a lollipop style plot (which is default) and a barplot, by use of the `type` argument. 

**Usage**

allInt(task, model, type)

**Example**

Load in the data:
```{r, messages = FALSE}
aq <- data.frame(airquality)
aq <- na.omit(aq)
```

Run an `mlr` random forest model:
```{r}
library(mlr)
library(randomForest)
aqRgrTask  <- makeRegrTask(data = aq, target = "Ozone")
aqRegrLrn <- makeLearner("regr.randomForest")
aqMod <- train(aqRegrLrn, aqRgrTask)
```

To call the pdp pairs plot we use:
```{r, fig.width = 8, fig.height = 7}
set.seed(1701)
allInt(task = aqRgrTask, model =  aqMod)
```
<center>
Fig 4.0: *A plot displaying all 2-way interaction in a model.*
</center>

From the above plot, we can see that the two variables with the greatest interaction strength are `Month:Day`.

# `interactionPlot()`

-----

*Creates a plot, displaying the overall interaction strength for each variable in a model*

-----

*Description*
Plots a "lollipop" style plot displating the varaibles on the y-axis and the overall interaction strength on the x-axis. This function also allows the user to switch between a lollipop style plot (which is default) and a barplot, by use of the `type` argument. 

**Usage**

interactionPlot(task, model, type)

**Example**

Load in the data:
```{r, messages = FALSE}
aq <- data.frame(airquality)
aq <- na.omit(aq)
```

Run an `mlr` random forest model:
```{r}
library(mlr)
library(randomForest)
aqRgrTask  <- makeRegrTask(data = aq, target = "Ozone")
aqRegrLrn <- makeLearner("regr.randomForest")
aqMod <- train(aqRegrLrn, aqRgrTask)
```

To call the pdp pairs plot we use:
```{r, fig.width = 8, fig.height = 7}
set.seed(1701)
interactionPlot(task = aqRgrTask, model =  aqMod)
```
<center>
Fig 5.0: *A plot displaying the overall interaction strength for each variable in a model.*
</center>

# `importancePlot()`

-----

*Creates a plot, displaying the variable importance for each variable in a model*

-----

*Description*
Plots a "lollipop" style plot displating the varaibles on the y-axis and the variable importance on the x-axis. This function also allows the user to switch between a lollipop style plot (which is default) and a barplot, by use of the `type` argument. 

**Usage**

importancePlot(task, model, type)

**Example**

Load in the data:
```{r, messages = FALSE}
aq <- data.frame(airquality)
aq <- na.omit(aq)
```

Run an `mlr` random forest model:
```{r}
library(mlr)
library(randomForest)
aqRgrTask  <- makeRegrTask(data = aq, target = "Ozone")
aqRegrLrn <- makeLearner("regr.randomForest")
aqMod <- train(aqRegrLrn, aqRgrTask)
```

To call the pdp pairs plot we use:
```{r, fig.width = 8, fig.height = 7}
set.seed(1701)
importancePlot(task = aqRgrTask, model =  aqMod)
```
<center>
Fig 6.0: *A plot displaying the variable importance for each variable in a model.*
</center>


